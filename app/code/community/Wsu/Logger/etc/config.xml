<?xml version="1.0" encoding="UTF-8"?>
<config>
  <modules>
    <Wsu_Logger>
      <version>1.0.0.0</version>
    </Wsu_Logger>
  </modules>
  <global>
    <models>
      <wsu_logger>
        <class>Wsu_Logger_Model</class>
        <resourceModel>wsu_logger_resource</resourceModel>
      </wsu_logger>
      <wsu_logger_resource>
        <class>Wsu_Logger_Model_Resource</class>
        <entities>
          <logger>
            <table>wsu_logger_logger</table>
          </logger>
          <download_log>
            <table>wsu_download_log</table>
          </download_log>
		<stock_movement>
			<table>wsu_stock_movement</table>
		</stock_movement>
        </entities>
      </wsu_logger_resource>
		<cataloginventory>
			<rewrite>
				<stock>Wsu_Logger_Model_CatalogInventory_Stock</stock>
			</rewrite>
		</cataloginventory>
    </models>
    <resources>
      <wsu_logger_setup>
        <setup>
          <module>Wsu_Logger</module>
        </setup>
      </wsu_logger_setup>
    </resources>
    <helpers>
      <wsu_logger>
        <class>Wsu_Logger_Helper</class>
      </wsu_logger>
    </helpers>
    <blocks>
      <wsu_logger>
        <class>Wsu_Logger_Block</class>
      </wsu_logger>
    </blocks>
    <log>
      <core>
        <!--<writer_model>Zend_Log_Writer_Stream</writer_model>-->
        <writer_model>Wsu_Logger_Model_Log_Writer_Stream</writer_model>
      </core>
    </log>
    <events>
      <controller_action_postdispatch_api>
        <observers>
          <apilog>
            <type>singleton</type>
            <class>apilog/observer</class>
            <method>controller_action_postdispatch_api</method>
          </apilog>
        </observers>
      </controller_action_postdispatch_api>
            <checkout_submit_all_after>
                <observers>
                    <wsu_logger>
                        <class>wsu_logger/stock_observer</class>
                        <method>checkoutAllSubmitAfter</method>
                    </wsu_logger>
                </observers>
            </checkout_submit_all_after>
            <cataloginventory_stock_item_save_after>
                <observers>
                    <wsu_logger>
                        <type>singleton</type>
                        <class>wsu_logger/stock_observer</class>
                        <method>saveStockItemAfter</method>
                    </wsu_logger>
                </observers>
            </cataloginventory_stock_item_save_after>
            <cataloginventory_stock_revert_products_sale>
                <observers>
                    <wsu_logger>
                        <class>wsu_logger/stock_observer</class>
                        <method>stockRevertProductsSale</method>
                    </wsu_logger>
                </observers>
            </cataloginventory_stock_revert_products_sale>
            <catalog_product_import_finish_before>
                <observers>
                    <wsu_logger>
                        <class>wsu_logger/stock_observer</class>
                        <method>catalogProductImportFinishBefore</method>
                    </wsu_logger>
                </observers>
            </catalog_product_import_finish_before>
            <controller_action_layout_render_before_adminhtml_catalog_product_edit>
                <observers>
                    <wsu_logger>
                        <class>wsu_logger/stock_observer</class>
                        <method>addStockMovementsTab</method>
                    </wsu_logger>
                </observers>
            </controller_action_layout_render_before_adminhtml_catalog_product_edit>
            <sales_order_item_cancel>
                <observers>
                    <inventory><type>disabled</type></inventory>
                    <wsu_logger>
                        <class>wsu_logger/stock_observer</class>
                        <method>cancelOrderItem</method>
                    </wsu_logger>
                </observers>
            </sales_order_item_cancel>
    </events>
  </global>
    <adminhtml>
        <events> 
            <controller_action_layout_generate_blocks_after>
                <observers>
                    <wsu_logger_index>
                        <type>singleton</type>
                        <class>wsu_logger/observer</class>
                        <method>addLoggerGridJavascriptBlock</method>
                    </wsu_logger_index>
                </observers>
            </controller_action_layout_generate_blocks_after>
        </events>       
    </adminhtml>
  <admin>
    <routers>
      <adminhtml>
        <args>
          <modules>
            <Wsu_Logger before="Mage_Adminhtml">Wsu_Logger_Adminhtml</Wsu_Logger>
          </modules>
        </args>
      </adminhtml>
    </routers>
  </admin>
  <default>
    <wsu_logger>
      <apilog>
        <enablelogging>1</enablelogging>
        <logformat>
<![CDATA[REQUEST URI: ###REQUESTURI###
CLIENT IP: ###CLIENTIP###
REQUEST:
====================
###REQUEST###

RESPONSE:
====================
###RESPONSE###]]>
        </logformat>
        <logfilename>api.log</logfilename>
      </apilog>
    </wsu_logger>
  </default>
</config>
